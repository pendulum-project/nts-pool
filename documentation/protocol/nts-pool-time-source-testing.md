# NTS Pool time source communication test cases

Below are several test nts requests for pool interactions with time sources. These can be used for testing implementations of servers. Note that the order of records is allowed to vary within the limits indicated in the [pool draft](https://datatracker.ietf.org/doc/draft-venhoek-nts-pool/)

## Fixed Key Request
Fixed key request for NTPv4, with AEAD_AES_SIV_CMAC_256 as Aead. C2S key is `\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F`, and S2C key is `\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2A\x2B\x2C\x2D\x2E\x2F\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3A\x3B\x3C\x3D\x3E\x3F`.

NTS request:
`\xC0\x02\x00\x40\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2A\x2B\x2C\x2D\x2E\x2F\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3A\x3B\x3C\x3D\x3E\x3F\x80\x01\x00\x02\x00\x00\x80\x04\x00\x02\x00\x0F\x80\x00\x00\x00`

NTS request including keepalive:
`\xC0\x02\x00\x40\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2A\x2B\x2C\x2D\x2E\x2F\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3A\x3B\x3C\x3D\x3E\x3F\x80\x01\x00\x02\x00\x00\x80\x04\x00\x02\x00\x0F\x80\x00\x00\x00`

Response should be a regular nts response, but using the keys above instead of those derived from the TLS connection.

## Protocol information requeests

The below request asks both the supported next protocols and aead algorithms:
`\xC0\x04\x00\x00\xC0\x01\x00\x00\x80\x00\x00\x00`

Response, assuming support for both AEAD_AES_SIV_CMAC_256 and AEAD_AES_SIV_CMAC_512 as AEADs, and NTPv4 as next protocol, should be something like
`\xC0\x04\x00\x02\x00\x00\xC0\x01\x00\x08\x00\x0F\x00\x20\x00\x11\x00\x40\x80\x00\x00\x00`

Supported protocols can also be asked for separately:
`\xC0\x04\x00\x00\x80\x00\x00\x00`
which should yield a response just for that:
`\xC0\x04\x00\x02\x00\x00\x80\x00\x00\x00`

As can the algorithm list:
`\xC0\x01\x00\x00\x80\x00\x00\x00`
With response:
`\xC0\x04\x00\x02\x00\x00\xC0\x01\x00\x08\x00\x0F\x00\x20\x00\x11\x00\x40\x80\x00\x00\x00`

# Testing using the pool key exchange server

It is also possible to test using the pool key exchange server. For this, put a test time source running your software in the list of servers at `nts-pool-ke/servers.json`. For this use case, the uuid can be any string and is irrelevant. You can then start the pool key exchange server by running `cargo run -- -c unsafe.pool.toml` within the `nts-pool-ke` folder. You should then be able to get a connection to your test time source using the pool as ke server from any nts capable ntp client, as the pool will respond to localhost port 4460. You may need to add the `nts-pool-ke/testdata/testca.pem` ca key to the trusted keys of the ntp client for testing, how to do this depends on the client in use.
