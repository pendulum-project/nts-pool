{% extends "../layout.html.j2" %}
{% block nav_time_sources %}aria-current="page"{% endblock %}

{% block header %}<h1>Time Sources</h1>{% endblock %}

{% block content %}
  <section class="form">
    <h2>Add a time source server</h2>
    <form action="/management/time-sources" method="POST">
      <div class="hostname-port">
        <fieldset class="hostname">
          <label for="hostname">Hostname or IP address</label>
          <input name="hostname" type="text" />
        </fieldset>
        <fieldset class="port">
          <label for="port">Port (optional)</label>
          <input name="port" type="text" />
        </fieldset>
      </div>
      <div>
        <button type="submit">Add</button>
      </div>
    </form>
  </section>
  <section>
    <h2>Time source servers</h2>
    <div class="time-sources-list">
      {% if time_sources.is_empty() %}
        No time sources servers added
      {% endif %}
      {%- for ts in time_sources %}
        <article class="card">
          <a href="/management/time-sources/{{ ts.id }}"><h3>{{ ts.hostname }}{% if let Some(p) = ts.port %}<span class="port">:{{ p }}</span>{% endif %}</h3></a>
          <form action="/management/time-sources/{{ ts.id }}/update" method="POST">
            <dl>
              <dd>Ipv4 score</dd>
              <dt>{{ ts.ipv4_score | fmt("{:.1}") }}</dt>
              <dd>Ipv6 score</dd>
              <dt>{{ ts.ipv6_score | fmt("{:.1}") }}</dt>
              <dd>Weight</dd>
              <dt><input type="number" name="weight" min="1" max="{{ app.max_timesource_weight }}" value="{{ ts.weight }}" /></dt>
            </dl>
            <button type="submit" class="btn-sm">Save</button>
          </form>
          <form class="card-action" action="/management/time-sources/{{ ts.id }}/delete" method="POST">
            <button type="button" class="btn-link" popovertarget="confirm-{{ ts.id }}">Delete</button>
            <dialog class="confirmation" popover id="confirm-{{ ts.id }}">
              <p>Are you sure you want to delete <strong> {{ ts.hostname }}{% if let Some(p) = ts.port %}<span class="port">:{{ p }}</span>{% endif %}</strong>?
              </p>
              <div class="dialog-actions">
                <button type="submit">Yes, delete</button>
                <button type="button" popovertarget="confirm-{{ ts.id }}" popovertargetaction="hide" class="btn-alt">Cancel</button>
              </div>
            </dialog>
          </form>
          <form action="/management/time-sources/{{ ts.id }}/rekey" method="POST">
            <button type="submit" class="btn-link">Rekey</button>
          </form>
        </article>
      {% endfor %}
    </div>
  </section>
{% endblock %}
