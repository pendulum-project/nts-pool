{% extends "../layout.html.j2" %}
{% block nav_time_sources %}aria-current="page"{% endblock %}

{% block header %}<h1>Time Sources</h1>{% endblock %}

{% block content %}
  <section class="form">
    <h2>Add a time source server</h2>
    <form action="/management/time-sources" method="POST">
      <div class="hostname-port">
        <fieldset class="hostname">
          <label for="hostname">Hostname or IP address</label>
          <input name="hostname" type="text" />
        </fieldset>
        <fieldset class="port">
          <label for="port">Port (optional)</label>
          <input name="port" type="text" />
        </fieldset>
      </div>
      <div>
        <button type="submit">Add</button>
      </div>
    </form>
  </section>
  <section>
    <h2>Time source servers</h2>
    <table>
      <thead>
        <th>Time Source</th>
        <th>IPv4 Score</th>
        <th>IPv6 Score</th>
        <th>SRV Score (Ipv4)</th>
        <th>SRV Score (Ipv6)</th>
        <th>Weight</th>
        <td><!-- Actions --></td>
      </thead>
      <tbody>
        {%- for ts in time_sources %}
          <tr>
            <td>
              <a href="/management/time-sources/{{ ts.id }}">{{ ts.hostname }}</a>
            </td>
            <td>{{ ts.ipv4_score | fmt("{:.1}") }}</td>
            <td>{{ ts.ipv6_score | fmt("{:.1}") }}</td>
            <td>{{ ts.srv4_score | fmt("{:.1}") }}</td>
            <td>{{ ts.srv6_score | fmt("{:.1}") }}</td>
            <td>
              <form action="/management/time-sources/{{ ts.id }}/update" method="POST">
                <input type="number" class="input-sm" name="weight" min="1" max="{{ app.max_timesource_weight }}" value="{{ ts.weight }}" />
                <button type="submit" class="btn-sm">Save</button>
              </form>
            </td>
            <td class="actions">
              <form action="/management/time-sources/{{ ts.id }}/rekey" method="POST">
                <button type="submit" class="btn-sm btn-alt">Rekey</button>
              </form>
              <form action="/management/time-sources/{{ ts.id }}/delete" method="POST">
                <button type="button" class="btn-sm error" popovertarget="confirm-{{ ts.id }}">Delete</button>
                <dialog class="confirmation" popover id="confirm-{{ ts.id }}">
                  <p>Are you sure you want to delete <strong> {{ ts.hostname }}{% if let Some(p) = ts.port %}<span class="port">:{{ p }}</span>{% endif %}</strong>?
                  </p>
                  <div class="dialog-actions">
                    <button type="submit" class="error">Yes, delete</button>
                    <button type="button" class="btn-alt" popovertarget="confirm-{{ ts.id }}" popovertargetaction="hide">Cancel</button>
                  </div>
                </dialog>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}
